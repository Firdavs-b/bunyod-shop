{% extends 'store/base.html' %}
{% load static %} 
{% block content %}
<div class="row g-4">
  <div class="col-lg-3">
    <div class="card p-3 shadow-sm">
      <h5 class="mb-3">Категорияҳо</h5>
      <div class="list-group">
        <a href="{% url 'home' %}" class="list-group-item list-group-item-action {% if not selected_category %}active{% endif %}">Ҳамаи махсулот</a>
        {% for c in categories %}
          <a href="?category={{ c.id }}" class="list-group-item list-group-item-action {% if selected_category and selected_category|add:'' == c.id|add:'' %}active{% endif %}">{{ c.name }}</a>
        {% endfor %}
      </div>
    </div>

    <div class="card p-3 mt-4 shadow-sm">
      <h6>Дар бораи мо</h6>
      <p class="small text-muted">Магозаи “Бунёд” — маҳсулоти босифат барои чорво. Сифат ва хидматрасонӣ - афзалияти мост.</p>
      <a href="{% url 'about' %}" class="btn btn-outline-primary btn-sm">Бештар</a>
    </div>
  </div>

  <div class="col-lg-9">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">Маҳсулотҳо</h3>
      <div class="text-muted small">
        {% if category_name %} Филтр: {{ category_name }} {% else %} Ҳамаи махсулот {% endif %}

      </div>
    </div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <div class="row g-4">
      {% for p in products %}
        <div class="col-6 col-md-4">
          <div class="card product-card h-100 shadow-sm">
            {% if p.image %}
              <img src="{{ p.image.url }}" class="card-img-top product-img" alt="{{ p.name }}">
            {% else %}
              <img src="{% static 'img/products/product1.jpg' %}" class="card-img-top product-img" alt="{{ p.name }}">
            {% endif %}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ p.name }}</h5>
              <p class="text-muted small mb-2">{{ p.description|truncatechars:80 }}</p>
              <div class="mt-auto d-flex justify-content-between align-items-center">
                <div class="fw-bold text-success">
                  <i class="bi bi-cash-stack"></i> {{ p.sell_price }} сомонӣ
                </div>

                <a href="{% url 'add_to_cart' p.id %}" class="btn btn-primary btn-sm btn-add">Ба сабад</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('.btn-add');
    buttons.forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const url = btn.getAttribute('href');

        // Пайдо кардани оинаи паём
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        toast.innerHTML = '✅ Ба сабад илова шуд!';
        document.body.appendChild(toast);

        // Пайдо шудан (бо аниматсия)
        setTimeout(() => toast.classList.add('show'), 100);

        // Аз байн рафтан пас аз 2.5 сония
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 2500);

        // Рафтан ба URL барои илова ба сабад
        setTimeout(() => { window.location.href = url; }, 400);
      });
    });
  });
</script>
